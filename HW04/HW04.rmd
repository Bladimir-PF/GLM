---
title: "HW04"
author: "Geraldo B. Padilla F."
date: "31-03-2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# HW04 using R

# set width of output and number of digits to be printed
options("width"=120, "digits"=8)
# turn off stars for different alpha levels
options(show.signif.stars=FALSE)

# Use this to turn off scientific notation: 
# "fixed notation will be preferred unless it is more than 'scipen' digits wide"
options(scipen=9)

#####  Check to see if packages are downloaded, install if not, then load  #####

```{r, message=FALSE}
library(readxl) # To import xls or xlsx data as table
library(expss) # To add variable and value labels, sorting
library(psych) # To add descriptive summary functions
library(multcomp) # To do glht linear combinations in GLMs
library(margins) # To get predicted values like Stata does
library(MASS) # To fit negative binomial model easily
library(TeachingDemos) # To create text output files
```

# Import homework data and add labels
HW04 <- read_excel("HW04/HW04_01445225.xlsx")

# Here are the variable labels (not to be included in data used)
FamilyID=   "FamilyID: Family ID"
HasYounger= "HasYounger: Has Younger Sibling (0=no, 1=yes)"
HasOlder=   "HasOlder: Has Older Sibling (0=no, 1=yes)"
BothWork=   "BothWork: Both Parents Work Full-Time (0=no 1=yes)"
FoodSchool= "FoodSchool: Number of Food School Sessions"
NumFoods=   "NumFoods: Number of New Foods Tried";

# Your code to center/recode predictors goes here


# Open output text file -- run this last if you want to save output
txtStart(file=paste0(filesave,"PSQF6270_HW04_Output.txt"))

# Your code to estimate models goes here

Empty models
```{r}
m0_p <- glm(NumFoods~1, family = poisson(link = 'log'), data = HW04)
summary(m0_p)
-2*logLik(m0_p); AIC(m0_p); BIC(m0_p)

DDFn=400     # What SAS uses
DDFk=DDFn-6  # What STATA uses
sum(residuals(m0_p, type="pearson")^2)/DDFn  # SAS
sum(residuals(ModelPoisson, type="pearson")^2)/DDFk  # STATA

exp(m0_p$coefficients)

m0_nb <- glm.nb(NumFoods~1, link = log, data = HW04)
summary(m0_nb); -2*logLik(m0_nb)
AIC(m0_nb); BIC(m0_nb)

sum(residuals(m0_nb, type = 'pearson')^2)/DDFn
exp(m0_nb$coefficients)

DevTest = -2*(logLik(m0_p)-logLik(m0_nb))
RegPvalue = pchisq((DevTest), df=1, lower.tail=FALSE)
MixPvalue = RegPvalue/2
DevTest; RegPvalue; MixPvalue

```



# Close output text file
txtStop()

ModelPoisson = glm(data=Example3, family=poisson(link="log"),
                   formula=aggr~1+ipv+NvC+NvS +ipv:NvC +ipv:NvS)
summary(ModelPoisson); print("Print -2LL, AIC, and BIC")
-2*logLik(ModelPoisson); AIC(ModelPoisson); BIC(ModelPoisson)

print("DF=5 Multiv Wald Test of Model -- matches SAS and STATA")
PoissonR2 = glht(model=ModelPoisson, 
                 linfct=c("ipv=0","NvC=0","NvS=0","ipv:NvC=0","ipv:NvS=0"))
print(summary(PoissonR2, test=Chisqtest()), digits="8") # Joint chi-square test 

print("DF=2 Multiv Wald Test of Interaction -- matches SAS and STATA")
PoissonInt = glht(model=ModelPoisson, linfct=c("ipv:NvC=0","ipv:NvS=0"))
print(summary(PoissonInt, test=Chisqtest()), digits="8") # Joint chi-square test